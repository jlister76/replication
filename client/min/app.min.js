!function(){"use strict";angular.module("Replication",["ui.router","lbServices","ngMaterial","ngMessages","ngLodash","moment-picker","ngAnimate","ngSanitize"]).config(["$httpProvider",function(a){try{a.interceptors.push(["$q","$location","LoopBackAuth",function(a,b,c){return{responseError:function(d){return 401!==d.status&&400!==d.status||(console.log("401 Error"),c.clearUser(),c.clearStorage(),b.nextAfterLogin=b.path(),b.path("/")),a.reject(d)}}}])}catch(a){console.log(a)}}]).run(["$rootScope","$state","$stateParams",function(a,b,c){a.title=b.current.title}])}(),function(){"use strict";angular.module("Replication").factory("AuthService",["Appuser",function(a){function b(b,c){var d={email:b,password:c},e={rememberMe:!1};return a.login(e,d)}function c(){return a.getCurrent()}function d(){return a.isAuthenticated()}function e(){return a.logout()}return{login:b,logout:e,isAuthenticated:d,getCurrent:c}}])}(),function(){"use strict";angular.module("Replication").controller("AppCtrl",function(){console.log("Checking for authentication...")}).controller("NavCtrl",["AuthService","$rootScope","$state","$scope",function(a,b,c,d){a.getCurrent().$promise.then(function(a){switch(a.company){case"HEATH":"group"===a.access_type&&(d.company="HEATH");break;case"ATMOS":d.company="ATMOS"}})}]).controller("RouterCtrl",["userCtx","$state",function(a,b){switch(a.company){case"HEATH":"group"===a.access_type&&b.go("authenticated.page.heath.replications");break;case"ATMOS":b.go("authenticated.page.atmos.replications")}}]).controller("LogInCtrl",["AuthService","$scope","$location","Appuser","$timeout",function(a,b,c,d,e){b.login=function(d,e){a.login(d,e).$promise.then(function(){console.log("Log-in successful. Redirecting to router.");var a;"/"===c.nextAfterLogin?(a="/router",c.nextAfterLogin=null,console.log(a),c.path(a)):(a=c.nextAfterLogin||"/router",c.nextAfterLogin=null,c.path(a))}).catch(function(a){a&&(console.log("auth error ",a),b.err=a)}).then(function(){})},b.resetPassword=function(a){d.resetPassword({email:a}).$promise.then(function(a){b.showResetForm=!1,b.confirmationMsg=!0,e(function(){b.confirmationMsg=!1,b.showResetForm=!1},5e3)}).catch(function(a){a&&(console.log(a.data.error.message),b.errMsg=a.data.error.message)})}}]).controller("LogOutCtrl",["AuthService","$scope","$location",function(a,b,c){b.logout=function(){console.log("Signing out..."),a.logout().$promise.then(function(){console.log("Signing out2..."),sessionStorage.clear()}),c.path("/")}}]).controller("HeathRequestedMeetingCtrl",["$scope","Meeting","requestedMeetings","proposedMeetings","$http","$timeout","$state","$location","$anchorScroll",function(a,b,c,d,e,f,g,h,i){function j(){var b=sessionStorage.getItem("data");a.request=JSON.parse(b)}var k=[];if(c.length>0)for(var l=0;l<c.length;l++)k.push(c[l]);if(d.length>0)for(var m=0;m<d.length;m++)k.push(d[m]);a.requests=k,a.confirmMeeting=function(c){a.pageReload=!0,a.pageMsg="<p>Scheduling Meeting</p>",a.showLinearProgress=!0,h.hash("pageReload"),i(),b.upsert({id:c.id,schedule_status:"confirmed"}).$promise.then(function(a){console.log(a,c),e.post("api/Meetings/heathConfirmed",{formData:a}).then(function(a){f(function(){g.reload()},1e3)}).catch(function(a){a&&console.error(a)})})},a.resend=function(b){a.pageReload=!0,h.hash("pageReload"),i(),a.pageMsg="<p>Emailing meeting request</p>",a.showLinearProgress=!0,e.post("api/Meetings/sendrequest",{formData:b}).then(function(a){f(function(){g.reload()},2500)})},a.cancelMeeting=function(c){a.pageReload=!0,h.hash("pageReload"),i(),a.pageMsg="<p>Cancelling meeting request</p>",a.showLinearProgress=!0,b.destroyById({id:c.id}).$promise.then(function(){e.post("api/Meetings/cancelMeeting",{formData:c}).then(function(){}).catch(function(a){a&&console.error(a)}),f(function(){g.reload()},1e3)})},a.viewRequest=function(a){sessionStorage.removeItem("data"),sessionStorage.setItem("data",JSON.stringify(a)),j()}}]).controller("HeathConfirmedMeetingCtrl",["$scope","$state","confirmedMeetings","Meeting","$http","$timeout","$location","$anchorScroll",function(a,b,c,d,e,f,g,h){function i(){var b=sessionStorage.getItem("data");a.meeting=JSON.parse(b)}a.meetings=c,a.viewMeeting=function(a){console.log(a),sessionStorage.removeItem("data"),sessionStorage.setItem("data",JSON.stringify(a)),i()},a.cancelMeeting=function(c){a.pageReload=!0,a.showLinearProgress=!0,a.pageMsg="<p>Cancelling meeting</p>",g.hash("pageReload"),h(),d.destroyById({id:c.id}).$promise.then(function(){e.post("api/Meetings/cancelMeeting",{formData:c}).then(function(){a.pageMsg="<p>Meeting Cancelled</p>",f(function(){b.reload()},2500)}).catch(function(a){a&&console.error(a)})}).catch(function(a){a&&console.error(a)})}}]).controller("HeathSchedulerCtrl",["userCtx","atmos","$scope","Meeting","$http","lodash","$timeout","$anchorScroll","$location","$rootScope","$state","suffixes","confirmedMeetings","confirmedAtmosMeetings","towns",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=f;c.date=moment(),c.twoWeeks=moment().add(2,"weeks");var q=[];for(var r in b)b[r].hasOwnProperty("email")&&q.push(b[r].email);var s={fname:"Send to",lname:"All",email:q};b.push(s);c.suffixes=p.uniqBy(l,"name"),c.request={team_leader:a.fname+" "+a.lname,team_leader_email:a.email},c.diameters=['1/2"','3/4"','1"','1 1/4"','1 1/2"','2"','3"','4"','6"','8"','12"','16"','18"','24"','36"'],c.materials=["Poly","Steel","Mill Wrap","Cast Iron","Coated Steel","Copper"],c.towns=p.uniqBy(o,"city"),c.atmos=b,c.sendMeetingRequest=function(b){switch(c.pageReload=!0,i.hash("pageReload"),h(),c.pageMsg="<p>Verifying schedules</p>",c.showLinearProgress=!0,typeof b.selected_dps){case"object":b.emailList=b.selected_dps;var f=[];p.forEach(n,function(a){moment(a.meeting_datetime).format()===moment(b.momentDate).format()&&f.push(a.email)}),p.forEach(b.emailList,function(h){if(-1===f.indexOf(h)){console.log(h);var i=p.capitalize(b.locate_technician_fname)+" "+p.capitalize(b.locate_technician_lname);b.location=b.street_number+" "+p.capitalize(b.street_name)+" "+b.street_suffix,b.facility=b.facility_size+" "+b.facility_material,d.create({email:h,meeting_datetime:b.momentDate,location_name:p.capitalize(b.location_name),location:b.location,cross_street:p.capitalize(b.cross_street),town:b.town,heath_report:b.heath_report,facility:b.facility,locate_technician:i,team_leader:b.team_leader,team_leader_email:a.email,team_leader_tel:a.tel,schedule_status:"pending"}).$promise.then(function(a){console.log(a),e.post("api/Meetings/sendrequest",{formData:a}).then(function(a){c.pageMsg="<p>Emailing meeting request</p>",g(function(){k.reload()},2500)})}).catch(function(a){console.error(a)})}});break;case"string":b.email=b.selected_dps,b.emailList=null,b.locate_technician=p.capitalize(b.locate_technician_fname)+" "+p.capitalize(b.locate_technician_lname),b.location=b.street_number+" "+p.capitalize(b.street_name)+" "+b.street_suffix,b.facility=b.facility_size+" "+b.facility_material,d.find({filter:{where:{email:b.email,schedule_status:"confirmed",meeting_datetime:b.momentDate}}}).$promise.then(function(f){for(var h=[],i=0;i<m.length;i++)h.push(m[i].meeting_datetime);0===f.length&&h!==b.momentDate?d.create({email:b.email,emailList:b.emailList,meeting_datetime:b.momentDate,location_name:p.capitalize(b.location_name),location:b.location,cross_street:p.capitalize(b.cross_street),town:b.town,heath_report:b.heath_report,facility:b.facility,locate_technician:b.locate_technician,team_leader:b.team_leader,team_leader_email:a.email,team_leader_tel:a.tel,schedule_status:"pending"}).$promise.then(function(a){e.post("api/Meetings/sendrequest",{formData:a}).then(function(a){c.pageMsg="<p>Emailing meeting request</p>",g(function(){k.reload()},2500)}).catch(function(a){a&&console.error(a)})}).catch(function(a){a&&console.error(a)}):(f.length>0||h===b.meeting_datetime)&&(c.showErrorIcon=!0,c.pageMsg="<p>Scheduling conflict</p>",g(function(){c.pageReload=!1},5e3))}).catch(function(a){a&&console.error(a)})}}}]).controller("HeathResponseCtrl",["$scope","$state","Replication","completedReplications","$http","$timeout","$location","$anchorScroll",function(a,b,c,d,e,f,g,h){function i(){var b=sessionStorage.getItem("data");a.replication=JSON.parse(b)}a.replications=d,a.viewReplication=function(a){sessionStorage.removeItem("data"),sessionStorage.setItem("data",JSON.stringify(a)),i()},a.addResponse=function(d){a.pageReload=!0,a.pageMsg="<p>Emailing response for review</p>",a.showLinearProgress=!0,g.hash("pageReload"),h(),c.upsert({id:d.id,heath_comments:d.comments,video_url:d.url}).$promise.then(function(a){e.post("api/Replications/sendResponse",{formData:a}).then(function(a){console.info("success return")}).catch(function(a){a&&console.error(a)}),f(function(){b.reload()},1500)}).catch(function(a){a&&console.error(a)})}}]).controller("AtmosUnscheduledReplicationCtrl",["userCtx","teamLeaders","suffixes","$scope","$http","Replication","lodash","$timeout","$anchorScroll","$location","$state","towns",function(a,b,c,d,e,f,g,h,i,j,k,l){var m=g;d.towns=m.uniqBy(l,"city"),d.suffixes=m.uniqBy(c,"name"),d.teamleaders=b,d.diameters=['1/2"','3/4"','1"','1 1/4"','1 1/2"','2"','3"','4"','6"','8"','12"','16"','18"','24"','36"'],d.materials=["Poly","Steel","Mill Wrap","Cast Iron","Coated Steel","Copper"],d.sendEmail=function(b){console.log(b.atmos_report),j.hash("pageReload"),i(),d.pageReload=!0,d.pageMsg="<p>Emailing replication results</p>",d.showLinearProgress=!0;var c=m.pick(JSON.parse(b.team_leader),"email"),g=m.pick(JSON.parse(b.team_leader),"fname"),l=m.pick(JSON.parse(b.team_leader),"lname"),n=g.fname+" "+l.lname,o=moment(),p=m.capitalize(b.locate_technician_fname)+" "+m.capitalize(b.locate_technician_lname),q=m.capitalize(b.street_name),r=m.capitalize(b.cross_street);f.create({replication_date:o,atmos_employee:a.fname+a.lname,atmos_employeeId:a.id,atmos_report:b.atmos_report,team_leader:n,team_leader_email:c.email,locate_technician:p,heath_report:b.heath_report,facility:b.facility_size+" "+b.facility_material,location:b.street_number+" "+q+" "+b.street_suffix,cross_street:r,town:b.town,isReplicated:b.able_to_replicate,atmos_determination:b.atmos_determination,corrective_actions:b.corrective_actions,able_to_locate:b.able_to_locate,is_line_marked:b.is_line_marked,atmos_comments:b.atmos_comments,heath_comments:null,video_url:null}).$promise.then(function(a){e.post("api/replications/sendemail",{formData:a}).then(function(a){d.pageMsg="<p>Email Sent!</p>",h(function(){k.reload()},2500)}).catch(function(a){a&&console.error(a)}),d.response.locate_technician_fname=null,d.response.locate_technician_lname=null,d.response.heath_report=null,d.response.facility_size=null,d.response.facility_material=null,d.response.street_number=null,d.response.street_name=null,d.response.street_suffix=null,d.response.cross_street=null,d.response.town=null,d.response.able_to_replicate=null,d.response.atmos_determination=null,d.response.atmos_comments=null,d.replicationForm.$setPristine()}).catch(function(a){a&&console.error(a)})}}]).controller("AtmosRequestedMeetingCtrl",["$scope","Meeting","userCtx","requestedMeetings","proposedMeetings","confirmedMeetings","$http","$timeout","$anchorScroll","$location","$state","towns",function(a,b,c,d,e,f,g,h,i,j,k,l){function m(){var b=sessionStorage.getItem("data");a.request=JSON.parse(b)}a.towns=_.uniqBy(l,"city"),a.today=moment(),a.twoWeeks=moment().add(2,"week");var n=[];if(d.length>0){for(var o=0;o<d.length;o++)n.push(d[o]);a.requests=n}if(e.length>0){for(var p=0;p<e.length;p++)n.push(e[p]);a.requests=n}f.length>0&&(a.meetings=f),a.confirmMeeting=function(d){a.pageReload=!0,a.pageMsg="Checking schedule...",a.showLinearProgress=!0,b.find({filter:{where:{email:c.email,schedule_status:"confirmed",meeting_datetime:d.meeting_datetime}}}).$promise.then(function(e){if(console.log(e),e.length>0){a.showLinearProgress=!1;_.get(e[0],"location"),_.get(e[0],"town");a.icon='<i class="material-icons">error</i>',a.pageMsg='<h4>Schedule conflict</h4><p class="md-body-1" style="width:100%;">Reschedule or decline this meeting.</p>',h(function(){a.pageReload=!1},7e3)}else b.upsert({id:d.id,schedule_status:"confirmed",fname:c.fname,lname:c.lname}).$promise.then(function(b){a.pageMsg="Scheduling Meeting",g.post("api/Meetings/confirmed",{formData:b}).then(function(a){h(function(){k.reload()},2e3)}).catch(function(a){a&&console.error(a)})}).catch(function(a){a&&console.error(a)})}).catch(function(a){a&&console.error(a)})},a.propose=function(d){a.team_leader_email=d.team_leader_email,a.pageReload=!0,a.pageMsg="Checking schedule...",a.showLinearProgress=!0;var e=[];_.forEach(f,function(a){moment(a.meeting_datetime).format()===moment(d.momentDate).format()&&e.push(d.momentDate)}),e.length>0?(console.log(e),a.showErrorIcon=!0,a.icon='<i class="material-icons">error</i>',a.pageMsg="Scheduling Conflict",h(function(){a.pageReload=!1},2500)):b.find({filter:{where:{team_leader:d.team_leader,schedule_status:"confirmed",meeting_datetime:d.momentDate}}}).$promise.then(function(e){if(e.length>0){a.showLinearProgress=!1;_.get(e[0],"location"),_.get(e[0],"town");a.showErrorIcon=!0,a.icon='<i class="material-icons">error</i>',a.pageMsg="Scheduling Conflict",h(function(){a.pageReload=!1},2500)}else 0===e.length&&(a.showErrorIcon=!1,a.pageMsg="Rescheduling meeting",b.upsert({id:d.id,schedule_status:"proposed",meeting_datetime:d.momentDate,fname:c.fname,lname:c.lname}).$promise.then(function(b){g.post("api/Meetings/proposed",{formData:b}).then(function(){a.pageMsg="Emailing "+b.team_leader,h(function(){k.reload()},2500)}).catch(function(a){a&&console.error(a)})}))}).catch(function(a){a&&console.error(a)})},a.viewRequest=function(a){sessionStorage.removeItem("data"),sessionStorage.setItem("data",JSON.stringify(a)),m()},a.declineMeeting=function(c){a.pageReload=!0,a.pageMsg="<p>Declining Meeting</p>",a.showLinearProgress=!0,j.hash("pageReload"),i(),b.destroyById({id:c.id}).$promise.then(function(){console.log(c),a.pageMsg="<p>Emailing "+c.team_leader+"</p>",g.post("api/Meetings/declined",{formData:c}).then(function(a){h(function(){k.reload()},2e3)}).catch(function(a){a&&console.error(a)})}).catch(function(a){a&&console.error(a)})}}]).controller("AtmosConfirmedMeetingCtrl",["$scope","Replication","Meeting","userCtx","confirmedMeetings","$http","$state","$timeout","$anchorScroll","$location",function(a,b,c,d,e,f,g,h,i,j){function k(){var b=sessionStorage.getItem("data");a.meeting=JSON.parse(b)}a.meetings=e,a.clearForm=function(a){a.atmos_determination=null,a.atmos_comments=null,a.actions_taken=null,a.atmos_determination=null,a.isLocatable=null,a.line_marked=null},a.sendEmail=function(e,k){j.hash("pageReload"),i();var l=moment();a.pageReload=!0,a.pageMsg="<p>Saving replication</p>",a.showLinearProgress=!0,b.create({replication_date:l,atmos_employee:d.fname+d.lname,atmos_employeeId:d.id,atmos_report:e.atmos_report,team_leader:k.team_leader,team_leader_email:k.team_leader_email,locate_technician:k.locate_technician,heath_report:k.heath_report,facility:k.facility,location:k.location,cross_street:k.cross_street,town:k.town,isReplicated:e.able_to_replicate,atmos_determination:e.atmos_determination,corrective_actions:e.corrective_actions,able_to_locate:e.able_to_locate,is_line_marked:e.is_line_marked,atmos_comments:e.atmos_comments,heath_comments:null,video_url:null}).$promise.then(function(b){a.pageMsg="<p>Emailing results</p>",f.post("api/replications/sendemail",{formData:b}).then(function(b){a.pageMsg="<p>Updating replication results</p>",c.upsert({id:k.id,schedule_status:"complete"}).$promise.then(function(){h(function(){a.pageReload=!1,g.reload()},5e3)}).catch(function(a){a&&console.error(a)})}).catch(function(a){a&&console.error(a)})}).catch(function(a){a&&console.error(a)})},a.viewMeeting=function(a){console.log(a),sessionStorage.removeItem("data"),sessionStorage.setItem("data",JSON.stringify(a)),k()}}]).controller("AtmosCompletedReplicationCtrl",["$scope","completedReplications",function(a,b){function c(){var b=sessionStorage.getItem("data");a.replication=JSON.parse(b)}a.replications=b,a.viewReplication=function(a){console.log(a),sessionStorage.removeItem("data"),sessionStorage.setItem("data",JSON.stringify(a)),c()}}])}(),"undefined"!=typeof module&&"undefined"!=typeof exports&&module.exports===exports&&(module.exports="lbServices"),function(a,b,c){"use strict";function d(a){var b=a.match(/^(?:https?:)?\/\/([^\/]+)/);return b?b[1]:null}var e="/api",f="authorization",g=d(e)||location.host,h=b.module("lbServices",["ngResource"]);h.factory("User",["LoopBackResource","LoopBackAuth","$injector","$q",function(a,b,c,d){var f=a(e+"/Users/:id",{id:"@id"},{prototype$__findById__accessTokens:{params:{fk:"@fk"},url:e+"/Users/:id/accessTokens/:fk",method:"GET"},prototype$__destroyById__accessTokens:{params:{fk:"@fk"},url:e+"/Users/:id/accessTokens/:fk",method:"DELETE"},prototype$__updateById__accessTokens:{params:{fk:"@fk"},url:e+"/Users/:id/accessTokens/:fk",method:"PUT"},prototype$__get__accessTokens:{isArray:!0,url:e+"/Users/:id/accessTokens",method:"GET"},prototype$__create__accessTokens:{url:e+"/Users/:id/accessTokens",method:"POST"},prototype$__delete__accessTokens:{url:e+"/Users/:id/accessTokens",method:"DELETE"},prototype$__count__accessTokens:{url:e+"/Users/:id/accessTokens/count",method:"GET"},create:{url:e+"/Users",method:"POST"},createMany:{isArray:!0,url:e+"/Users",method:"POST"},patchOrCreate:{url:e+"/Users",method:"PATCH"},replaceOrCreate:{url:e+"/Users/replaceOrCreate",method:"POST"},upsertWithWhere:{url:e+"/Users/upsertWithWhere",method:"POST"},exists:{url:e+"/Users/:id/exists",method:"GET"},findById:{url:e+"/Users/:id",method:"GET"},replaceById:{url:e+"/Users/:id/replace",method:"POST"},find:{isArray:!0,url:e+"/Users",method:"GET"},findOne:{url:e+"/Users/findOne",method:"GET"},updateAll:{url:e+"/Users/update",method:"POST"},deleteById:{url:e+"/Users/:id",method:"DELETE"},count:{url:e+"/Users/count",method:"GET"},prototype$patchAttributes:{url:e+"/Users/:id",method:"PATCH"},createChangeStream:{url:e+"/Users/change-stream",method:"POST"},login:{params:{include:"user"},interceptor:{response:function(a){var c=a.data;return b.setUser(c.id,c.userId,c.user),b.rememberMe=!1!==a.config.params.rememberMe,b.save(),a.resource}},url:e+"/Users/login",method:"POST"},logout:{interceptor:{response:function(a){return b.clearUser(),b.clearStorage(),a.resource},responseError:function(a){return b.clearUser(),b.clearStorage(),a.resource}},url:e+"/Users/logout",method:"POST"},confirm:{url:e+"/Users/confirm",method:"GET"},resetPassword:{url:e+"/Users/reset",method:"POST"},changePassword:{url:e+"/Users/change-password",method:"POST"},"::get::AccessToken::user":{url:e+"/AccessTokens/:id/user",method:"GET"},getCurrent:{url:e+"/Users/:id",method:"GET",params:{id:function(){var a=b.currentUserId;return null==a&&(a="__anonymous__"),a}},interceptor:{response:function(a){return b.currentUserData=a.data,a.resource},responseError:function(a){return b.clearUser(),b.clearStorage(),d.reject(a)}},__isGetCurrentUser__:!0}});return f.upsert=f.patchOrCreate,f.updateOrCreate=f.patchOrCreate,f.patchOrCreateWithWhere=f.upsertWithWhere,f.update=f.updateAll,f.destroyById=f.deleteById,f.removeById=f.deleteById,f.prototype$updateAttributes=f.prototype$patchAttributes,f.getCachedCurrent=function(){var a=b.currentUserData;return a?new f(a):null},f.isAuthenticated=function(){return null!=this.getCurrentId()},f.getCurrentId=function(){return b.currentUserId},f.modelName="User",f.accessTokens=function(){return c.get("AccessToken")["::get::User::accessTokens"].apply(f,arguments)},f.accessTokens.count=function(){return c.get("AccessToken")["::count::User::accessTokens"].apply(f,arguments)},f.accessTokens.create=function(){return c.get("AccessToken")["::create::User::accessTokens"].apply(f,arguments)},f.accessTokens.createMany=function(){return c.get("AccessToken")["::createMany::User::accessTokens"].apply(f,arguments)},f.accessTokens.destroyAll=function(){return c.get("AccessToken")["::delete::User::accessTokens"].apply(f,arguments)},f.accessTokens.destroyById=function(){return c.get("AccessToken")["::destroyById::User::accessTokens"].apply(f,arguments)},f.accessTokens.findById=function(){return c.get("AccessToken")["::findById::User::accessTokens"].apply(f,arguments)},f.accessTokens.updateById=function(){return c.get("AccessToken")["::updateById::User::accessTokens"].apply(f,arguments)},f}]),h.factory("AccessToken",["LoopBackResource","LoopBackAuth","$injector","$q",function(a,b,c,d){var f=a(e+"/AccessTokens/:id",{id:"@id"},{prototype$__get__user:{url:e+"/AccessTokens/:id/user",method:"GET"},create:{url:e+"/AccessTokens",method:"POST"},createMany:{isArray:!0,url:e+"/AccessTokens",method:"POST"},patchOrCreate:{url:e+"/AccessTokens",method:"PATCH"},replaceOrCreate:{url:e+"/AccessTokens/replaceOrCreate",method:"POST"},upsertWithWhere:{url:e+"/AccessTokens/upsertWithWhere",method:"POST"},exists:{url:e+"/AccessTokens/:id/exists",method:"GET"},findById:{url:e+"/AccessTokens/:id",method:"GET"},replaceById:{url:e+"/AccessTokens/:id/replace",method:"POST"},find:{isArray:!0,url:e+"/AccessTokens",method:"GET"},findOne:{url:e+"/AccessTokens/findOne",method:"GET"},updateAll:{url:e+"/AccessTokens/update",method:"POST"},deleteById:{url:e+"/AccessTokens/:id",method:"DELETE"},count:{url:e+"/AccessTokens/count",method:"GET"},prototype$patchAttributes:{url:e+"/AccessTokens/:id",method:"PATCH"},createChangeStream:{url:e+"/AccessTokens/change-stream",method:"POST"},"::findById::User::accessTokens":{params:{fk:"@fk"},url:e+"/Users/:id/accessTokens/:fk",method:"GET"},"::destroyById::User::accessTokens":{params:{fk:"@fk"},url:e+"/Users/:id/accessTokens/:fk",method:"DELETE"},"::updateById::User::accessTokens":{params:{fk:"@fk"},url:e+"/Users/:id/accessTokens/:fk",method:"PUT"},"::get::User::accessTokens":{isArray:!0,url:e+"/Users/:id/accessTokens",method:"GET"},"::create::User::accessTokens":{url:e+"/Users/:id/accessTokens",method:"POST"},"::createMany::User::accessTokens":{isArray:!0,url:e+"/Users/:id/accessTokens",method:"POST"},"::delete::User::accessTokens":{url:e+"/Users/:id/accessTokens",method:"DELETE"},"::count::User::accessTokens":{url:e+"/Users/:id/accessTokens/count",method:"GET"},"::findById::Appuser::accessTokens":{params:{fk:"@fk"},url:e+"/appusers/:id/accessTokens/:fk",method:"GET"},"::destroyById::Appuser::accessTokens":{params:{fk:"@fk"},url:e+"/appusers/:id/accessTokens/:fk",method:"DELETE"},"::updateById::Appuser::accessTokens":{params:{fk:"@fk"},url:e+"/appusers/:id/accessTokens/:fk",method:"PUT"},"::get::Appuser::accessTokens":{isArray:!0,url:e+"/appusers/:id/accessTokens",method:"GET"},"::create::Appuser::accessTokens":{url:e+"/appusers/:id/accessTokens",method:"POST"},"::createMany::Appuser::accessTokens":{isArray:!0,url:e+"/appusers/:id/accessTokens",method:"POST"},"::delete::Appuser::accessTokens":{url:e+"/appusers/:id/accessTokens",method:"DELETE"},"::count::Appuser::accessTokens":{url:e+"/appusers/:id/accessTokens/count",method:"GET"}});return f.upsert=f.patchOrCreate,f.updateOrCreate=f.patchOrCreate,f.patchOrCreateWithWhere=f.upsertWithWhere,f.update=f.updateAll,f.destroyById=f.deleteById,f.removeById=f.deleteById,f.prototype$updateAttributes=f.prototype$patchAttributes,f.modelName="AccessToken",f.user=function(){return c.get("User")["::get::AccessToken::user"].apply(f,arguments)},f}]),h.factory("Replication",["LoopBackResource","LoopBackAuth","$injector","$q",function(a,b,c,d){var f=a(e+"/replications/:id",{id:"@id"},{create:{url:e+"/replications",method:"POST"},createMany:{isArray:!0,url:e+"/replications",method:"POST"},patchOrCreate:{url:e+"/replications",method:"PATCH"},replaceOrCreate:{url:e+"/replications/replaceOrCreate",method:"POST"},upsertWithWhere:{url:e+"/replications/upsertWithWhere",method:"POST"},exists:{url:e+"/replications/:id/exists",method:"GET"},findById:{url:e+"/replications/:id",method:"GET"},replaceById:{url:e+"/replications/:id/replace",method:"POST"},find:{isArray:!0,url:e+"/replications",method:"GET"},findOne:{url:e+"/replications/findOne",method:"GET"},updateAll:{url:e+"/replications/update",method:"POST"},deleteById:{url:e+"/replications/:id",method:"DELETE"},count:{url:e+"/replications/count",method:"GET"},prototype$patchAttributes:{url:e+"/replications/:id",method:"PATCH"},createChangeStream:{url:e+"/replications/change-stream",method:"POST"},sendemail:{url:e+"/replications/sendemail",method:"POST"},sendResponse:{url:e+"/replications/sendresponse",method:"POST"}});return f.upsert=f.patchOrCreate,f.updateOrCreate=f.patchOrCreate,f.patchOrCreateWithWhere=f.upsertWithWhere,f.update=f.updateAll,f.destroyById=f.deleteById,f.removeById=f.deleteById,f.prototype$updateAttributes=f.prototype$patchAttributes,f.modelName="Replication",f}]),h.factory("Email",["LoopBackResource","LoopBackAuth","$injector","$q",function(a,b,c,d){var f=a(e+"/Emails/:id",{id:"@id"},{});return f.modelName="Email",f}]),h.factory("Appuser",["LoopBackResource","LoopBackAuth","$injector","$q",function(a,b,c,d){var f=a(e+"/appusers/:id",{id:"@id"},{prototype$__findById__accessTokens:{params:{fk:"@fk"},url:e+"/appusers/:id/accessTokens/:fk",method:"GET"},prototype$__destroyById__accessTokens:{params:{fk:"@fk"},url:e+"/appusers/:id/accessTokens/:fk",method:"DELETE"},prototype$__updateById__accessTokens:{params:{fk:"@fk"},url:e+"/appusers/:id/accessTokens/:fk",method:"PUT"},prototype$__get__accessTokens:{isArray:!0,url:e+"/appusers/:id/accessTokens",method:"GET"},prototype$__create__accessTokens:{url:e+"/appusers/:id/accessTokens",method:"POST"},prototype$__delete__accessTokens:{url:e+"/appusers/:id/accessTokens",method:"DELETE"},prototype$__count__accessTokens:{url:e+"/appusers/:id/accessTokens/count",method:"GET"},create:{url:e+"/appusers",method:"POST"},createMany:{isArray:!0,url:e+"/appusers",method:"POST"},patchOrCreate:{url:e+"/appusers",method:"PATCH"},replaceOrCreate:{url:e+"/appusers/replaceOrCreate",method:"POST"},upsertWithWhere:{url:e+"/appusers/upsertWithWhere",method:"POST"},exists:{url:e+"/appusers/:id/exists",method:"GET"},findById:{url:e+"/appusers/:id",method:"GET"},replaceById:{url:e+"/appusers/:id/replace",method:"POST"},find:{isArray:!0,url:e+"/appusers",method:"GET"},findOne:{url:e+"/appusers/findOne",method:"GET"},updateAll:{url:e+"/appusers/update",method:"POST"},deleteById:{url:e+"/appusers/:id",method:"DELETE"},count:{url:e+"/appusers/count",method:"GET"},prototype$patchAttributes:{url:e+"/appusers/:id",method:"PATCH"},createChangeStream:{url:e+"/appusers/change-stream",method:"POST"},login:{params:{include:"user"},interceptor:{response:function(a){var c=a.data;return b.setUser(c.id,c.userId,c.user),b.rememberMe=!1!==a.config.params.rememberMe,b.save(),a.resource}},url:e+"/appusers/login",method:"POST"},logout:{interceptor:{response:function(a){return b.clearUser(),b.clearStorage(),a.resource},responseError:function(a){return b.clearUser(),b.clearStorage(),a.resource}},url:e+"/appusers/logout",method:"POST"},confirm:{url:e+"/appusers/confirm",method:"GET"},resetPassword:{url:e+"/appusers/reset",method:"POST"},changePassword:{url:e+"/appusers/change-password",method:"POST"},getCurrent:{url:e+"/appusers/:id",method:"GET",params:{id:function(){var a=b.currentUserId;return null==a&&(a="__anonymous__"),a}},interceptor:{response:function(a){return b.currentUserData=a.data,a.resource},responseError:function(a){return b.clearUser(),b.clearStorage(),d.reject(a)}},__isGetCurrentUser__:!0}});return f.upsert=f.patchOrCreate,f.updateOrCreate=f.patchOrCreate,f.patchOrCreateWithWhere=f.upsertWithWhere,f.update=f.updateAll,f.destroyById=f.deleteById,f.removeById=f.deleteById,f.prototype$updateAttributes=f.prototype$patchAttributes,f.getCachedCurrent=function(){var a=b.currentUserData;return a?new f(a):null},f.isAuthenticated=function(){return null!=this.getCurrentId()},f.getCurrentId=function(){return b.currentUserId},f.modelName="Appuser",f.accessTokens=function(){return c.get("AccessToken")["::get::Appuser::accessTokens"].apply(f,arguments)},f.accessTokens.count=function(){return c.get("AccessToken")["::count::Appuser::accessTokens"].apply(f,arguments)},f.accessTokens.create=function(){return c.get("AccessToken")["::create::Appuser::accessTokens"].apply(f,arguments)},f.accessTokens.createMany=function(){return c.get("AccessToken")["::createMany::Appuser::accessTokens"].apply(f,arguments)},f.accessTokens.destroyAll=function(){return c.get("AccessToken")["::delete::Appuser::accessTokens"].apply(f,arguments)},f.accessTokens.destroyById=function(){return c.get("AccessToken")["::destroyById::Appuser::accessTokens"].apply(f,arguments)},f.accessTokens.findById=function(){return c.get("AccessToken")["::findById::Appuser::accessTokens"].apply(f,arguments)},f.accessTokens.updateById=function(){return c.get("AccessToken")["::updateById::Appuser::accessTokens"].apply(f,arguments)},f}]),h.factory("Meeting",["LoopBackResource","LoopBackAuth","$injector","$q",function(a,b,c,d){var f=a(e+"/meetings/:id",{id:"@id"},{create:{url:e+"/meetings",method:"POST"},createMany:{isArray:!0,url:e+"/meetings",method:"POST"},patchOrCreate:{url:e+"/meetings",method:"PATCH"},replaceOrCreate:{url:e+"/meetings/replaceOrCreate",method:"POST"},upsertWithWhere:{url:e+"/meetings/upsertWithWhere",method:"POST"},exists:{url:e+"/meetings/:id/exists",method:"GET"},findById:{url:e+"/meetings/:id",method:"GET"},replaceById:{url:e+"/meetings/:id/replace",method:"POST"},find:{isArray:!0,url:e+"/meetings",method:"GET"},findOne:{url:e+"/meetings/findOne",method:"GET"},updateAll:{url:e+"/meetings/update",method:"POST"},deleteById:{url:e+"/meetings/:id",method:"DELETE"},count:{url:e+"/meetings/count",method:"GET"},prototype$patchAttributes:{url:e+"/meetings/:id",method:"PATCH"},createChangeStream:{url:e+"/meetings/change-stream",method:"POST"},declined:{url:e+"/meetings/declined",method:"POST"},cancelMeeting:{url:e+"/meetings/cancelMeeting",method:"POST"},heathConfirmed:{url:e+"/meetings/heathConfirmed",method:"POST"},confirmed:{url:e+"/meetings/confirmed",method:"POST"},proposed:{url:e+"/meetings/proposed",method:"POST"},sendRequest:{url:e+"/meetings/sendrequest",method:"POST"}});return f.upsert=f.patchOrCreate,f.updateOrCreate=f.patchOrCreate,f.patchOrCreateWithWhere=f.upsertWithWhere,f.update=f.updateAll,f.destroyById=f.deleteById,f.removeById=f.deleteById,f.prototype$updateAttributes=f.prototype$patchAttributes,f.modelName="Meeting",f}]),h.factory("Suffix",["LoopBackResource","LoopBackAuth","$injector","$q",function(a,b,c,d){var f=a(e+"/suffixes/:id",{id:"@id"},{create:{url:e+"/suffixes",method:"POST"},createMany:{isArray:!0,url:e+"/suffixes",method:"POST"},patchOrCreate:{url:e+"/suffixes",method:"PATCH"},replaceOrCreate:{url:e+"/suffixes/replaceOrCreate",method:"POST"},upsertWithWhere:{url:e+"/suffixes/upsertWithWhere",method:"POST"},exists:{url:e+"/suffixes/:id/exists",method:"GET"},findById:{url:e+"/suffixes/:id",method:"GET"},replaceById:{url:e+"/suffixes/:id/replace",method:"POST"},find:{isArray:!0,url:e+"/suffixes",method:"GET"},findOne:{url:e+"/suffixes/findOne",method:"GET"},updateAll:{url:e+"/suffixes/update",method:"POST"},deleteById:{url:e+"/suffixes/:id",method:"DELETE"},count:{url:e+"/suffixes/count",method:"GET"},prototype$patchAttributes:{url:e+"/suffixes/:id",method:"PATCH"},createChangeStream:{url:e+"/suffixes/change-stream",method:"POST"}});return f.upsert=f.patchOrCreate,f.updateOrCreate=f.patchOrCreate,f.patchOrCreateWithWhere=f.upsertWithWhere,f.update=f.updateAll,f.destroyById=f.deleteById,f.removeById=f.deleteById,f.prototype$updateAttributes=f.prototype$patchAttributes,f.modelName="Suffix",f}]),h.factory("Town",["LoopBackResource","LoopBackAuth","$injector","$q",function(a,b,c,d){var f=a(e+"/towns/:id",{id:"@id"},{create:{url:e+"/towns",method:"POST"},createMany:{isArray:!0,url:e+"/towns",method:"POST"},patchOrCreate:{url:e+"/towns",method:"PATCH"},replaceOrCreate:{url:e+"/towns/replaceOrCreate",method:"POST"},upsertWithWhere:{url:e+"/towns/upsertWithWhere",method:"POST"},exists:{
url:e+"/towns/:id/exists",method:"GET"},findById:{url:e+"/towns/:id",method:"GET"},replaceById:{url:e+"/towns/:id/replace",method:"POST"},find:{isArray:!0,url:e+"/towns",method:"GET"},findOne:{url:e+"/towns/findOne",method:"GET"},updateAll:{url:e+"/towns/update",method:"POST"},deleteById:{url:e+"/towns/:id",method:"DELETE"},count:{url:e+"/towns/count",method:"GET"},prototype$patchAttributes:{url:e+"/towns/:id",method:"PATCH"},createChangeStream:{url:e+"/towns/change-stream",method:"POST"}});return f.upsert=f.patchOrCreate,f.updateOrCreate=f.patchOrCreate,f.patchOrCreateWithWhere=f.upsertWithWhere,f.update=f.updateAll,f.destroyById=f.deleteById,f.removeById=f.deleteById,f.prototype$updateAttributes=f.prototype$patchAttributes,f.modelName="Town",f}]),h.factory("LoopBackAuth",function(){function a(){var a=this;d.forEach(function(b){a[b]=c(b)}),this.currentUserData=null}function b(a,b,c){try{var d=e+b;null==c&&(c=""),a[d]=c}catch(a){console.log("Cannot access local/session storage:",a)}}function c(a){var b=e+a;return localStorage[b]||sessionStorage[b]||null}var d=["accessTokenId","currentUserId","rememberMe"],e="$LoopBack$";return a.prototype.save=function(){var a=this,c=this.rememberMe?localStorage:sessionStorage;d.forEach(function(d){b(c,d,a[d])})},a.prototype.setUser=function(a,b,c){this.accessTokenId=a,this.currentUserId=b,this.currentUserData=c},a.prototype.clearUser=function(){this.accessTokenId=null,this.currentUserId=null,this.currentUserData=null},a.prototype.clearStorage=function(){d.forEach(function(a){b(sessionStorage,a,null),b(localStorage,a,null)})},new a}).config(["$httpProvider",function(a){a.interceptors.push("LoopBackAuthRequestInterceptor")}]).factory("LoopBackAuthRequestInterceptor",["$q","LoopBackAuth",function(a,b){return{request:function(c){var e=d(c.url);if(e&&e!==g)return c;if(b.accessTokenId)c.headers[f]=b.accessTokenId;else if(c.__isGetCurrentUser__){var h={body:{error:{status:401}},status:401,config:c,headers:function(){}};return a.reject(h)}return c||a.when(c)}}}]).provider("LoopBackResource",function(){this.setAuthHeader=function(a){f=a},this.getAuthHeader=function(){return f},this.setUrlBase=function(a){e=a,g=d(e)||location.host},this.getUrlBase=function(){return e},this.$get=["$resource",function(a){var b=function(b,c,d){var e=a(b,c,d);return e.prototype.$save=function(a,b){var c=e.upsert.call(this,{},this,a,b);return c.$promise||c},e};return b.getUrlBase=function(){return e},b.getAuthHeader=function(){return f},b}]})}(window,window.angular),function(){"use strict";angular.module("Replication").config(["$stateProvider","$urlRouterProvider",function(a,b){a.state("app",{url:"/",controller:"LogInCtrl",templateUrl:"views/login-form.html"}).state("router",{url:"/router",resolve:{userCtx:["AuthService",function(a){return a.getCurrent().$promise}]},controller:"RouterCtrl"}).state("authenticated",{abstract:!0,templateUrl:"views/page-template.html"}).state("authenticated.page",{views:{navigation:{templateUrl:"views/navigation.html",controller:"NavCtrl"},mainContent:{templateUrl:"views/content-template.html"}}}).state("authenticated.page.heath",{abstract:!0,url:"/heath",templateUrl:"views/heath-page.html",resolve:{userCtx:["AuthService",function(a){return a.getCurrent().$promise}],atmos:["Appuser",function(a){return a.find({filter:{where:{company:"ATMOS",access_type:"dps",division:"midtx"}}}).$promise}],access:["userCtx","$state",function(a,b){"ATMOS"===a.company&&(console.error("403 Forbidden Access"),b.go("app.atmos"))}],completedReplications:["Replication","userCtx",function(a,b){var c=moment().subtract(1,"month");return a.find({filter:{where:{team_leader_email:b.email,replication_date:{gte:c}}}}).$promise}],requestedMeetings:["userCtx","Meeting",function(a,b){var c=moment();return b.find({filter:{where:{team_leader_email:a.email,schedule_status:"pending",meeting_datetime:{gte:c}}}}).$promise}],proposedMeetings:["Meeting","userCtx",function(a,b){var c=moment();return a.find({filter:{where:{team_leader_email:b.email,schedule_status:"proposed",meeting_datetime:{gte:c}}}})}],confirmedMeetings:["Meeting","userCtx",function(a,b){var c=moment();return a.find({filter:{where:{team_leader_email:b.email,schedule_status:"confirmed",meeting_datetime:{gte:c}}}}).$promise}],confirmedAtmosMeetings:["Meeting",function(a){var b=moment().add(2,"weeks");return a.find({filter:{where:{schedule_status:"confirmed",meeting_datetime:{lte:b}}}}).$promise}],suffixes:["Suffix",function(a){return a.find().$promise}],towns:["Town",function(a){return a.find().$promise}]}}).state("authenticated.page.heath.replications",{url:"",views:{requested:{templateUrl:"views/heath-requested-meetings.html",controller:"HeathRequestedMeetingCtrl"},scheduled:{templateUrl:"views/heath-scheduled-meetings.html",controller:"HeathConfirmedMeetingCtrl"},completed:{templateUrl:"views/heath-completed-replications.html",controller:"HeathResponseCtrl"},scheduling:{templateUrl:"views/heath-scheduler.html",controller:"HeathSchedulerCtrl"}}}).state("authenticated.page.atmos",{abstract:!0,url:"/atmos",templateUrl:"views/atmos-page.html",resolve:{userCtx:["AuthService",function(a){return a.getCurrent().$promise}],access:["userCtx","$state",function(a,b){"HEATH"===a.company&&(console.error("403 Forbidden Access"),b.go("app.heath"))}],completedReplications:["Replication","userCtx",function(a,b){var c=moment().subtract(1,"month");return a.find({filter:{where:{atmos_employeeId:b.id,replication_date:{gte:c}}}}).$promise}],requestedMeetings:["userCtx","Meeting",function(a,b){var c=moment();return b.find({filter:{where:{email:a.email,schedule_status:"pending",meeting_datetime:{gte:c}}}}).$promise}],proposedMeetings:["Meeting","userCtx",function(a,b){var c=moment();return a.find({filter:{where:{email:b.email,schedule_status:"proposed",meeting_datetime:{gte:c}}}})}],confirmedMeetings:["Meeting","userCtx",function(a,b){var c=moment();return a.find({filter:{where:{email:b.email,schedule_status:"confirmed",meeting_datetime:{gte:c}}}}).$promise}],suffixes:["Suffix",function(a){return a.find().$promise}],towns:["Town",function(a){return a.find().$promise}]}}).state("authenticated.page.atmos.replications",{url:"",views:{requested:{templateUrl:"views/atmos-requested-meetings.html",controller:"AtmosRequestedMeetingCtrl"},scheduled:{templateUrl:"views/atmos-scheduled-meetings.html",controller:"AtmosConfirmedMeetingCtrl",resolve:{confirmedMeetings:["Meeting","userCtx",function(a,b){var c=moment().subtract(1,"months");return a.find({filter:{where:{email:b.email,schedule_status:"confirmed",meeting_datetime:{gte:c}}}}).$promise.then(function(a){console.log(a)})}]}},completed:{templateUrl:"views/atmos-completed-replications.html",controller:"AtmosCompletedReplicationCtrl"},unscheduled:{templateUrl:"views/replication-form.html",resolve:{teamLeaders:["Appuser",function(a){return a.find({filter:{where:{company:"HEATH",accessLevel:"group"}}}).$promise}]},controller:"AtmosUnscheduledReplicationCtrl"}}}).state("authenticated.page.heath.scheduling",{url:"",resolve:{userCtx:["AuthService",function(a){return a.getCurrent().$promise}],atmos:["Appuser",function(a){return a.find({filter:{where:{company:"ATMOS",access_type:"dps",division:"midtx"}}}).$promise}],access:["userCtx","$state",function(a,b){"ATMOS"===a.company&&(console.error("403 Forbidden Access"),b.transitionTo("app.atmos"))}]},templateUrl:"views/heath-scheduler.html",controller:"HeathSchedulerCtrl",title:"Replication"}).state("app.error",{url:"/error",templateUrl:"views/location-error.html"}).state("login",{url:"/login",controller:"LogInCtrl"}).state("authenticated.page.logout",{url:"/logout",controller:["AuthService","$state",function(a,b){a.logout().$promise.then(function(a){sessionStorage.clear(),console.info("logging out"),b.go("app")})}]}),b.otherwise("/")}])}();